
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alerting &#8212; Data Driven Development</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Accessing Metrics" href="accessing_metrics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/aicoe-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Driven Development</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../README.html">
   Data Driven Development - D^3
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Sources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../data-sources/prometheus.html">
   Prometheus
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Presentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../data-presentation/grafana.html">
   Grafana Dashboards
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data-presentation/superset.html">
   Superset
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Monitoring Applications Guide
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   Monitoring Applications
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   Kebechet
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="tooling.html">
     Tooling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="metrics.html">
     Monitoring Metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="collecting_and_storing_metrics.html">
     Collecting and Storing Metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="accessing_metrics.html">
     Accessing Metrics
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Alerting
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/examples/kebechet/alerting.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/AICoE/data-driven-development"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/AICoE/data-driven-development/issues/new?title=Issue%20on%20page%20%2Fexamples/kebechet/alerting.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Alerting
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#alerts-kebechet">
   Alerts: Kebechet
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="alerting">
<h1>Alerting<a class="headerlink" href="#alerting" title="Permalink to this headline">¶</a></h1>
<p>Alerting on metrics is essential to monitoring. They allow you to spot problems anywhere in your infrastructure, application, etc so that you can rapidly identify their causes and minimize service degradation and disruption. An alert should communicate something specific about your systems such as “90% of all web requests are taking more than 0.5s to process and respond.” Receiving these alerts allows you to respond quickly to issues and provide better service, and it also saves time by freeing you from continual manual inspection of metrics.</p>
<p>You can get notified of these alerts through emails, Slack etc. Our team uses the <a class="reference external" href="https://github.com/m-lab/alertmanager-github-receiver">GitHub Alertmanager</a> to handle all the alerts. The GitHub Alertmanager is a webhook receiver that creates GitHub issues from alerts. To learn more about setting up the GitHub Alertmanager, you can refer to our <a class="reference external" href="https://www.operate-first.cloud/operations/sre/incident-management/github-receiver-setup.md">documentation</a>.</p>
</div>
<div class="section" id="alerts-kebechet">
<h1>Alerts: Kebechet<a class="headerlink" href="#alerts-kebechet" title="Permalink to this headline">¶</a></h1>
<p>You can find below the alerts defined for Kebechet.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Alert</strong></p></th>
<th class="head"><p><strong>Alert Definition</strong></p></th>
<th class="head"><p><strong>Alert Rule</strong></p></th>
<th class="head"><p><strong>Mitigation Plan</strong></p></th>
<th class="head"><p><strong>Alert Provider</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Thoth User-API is down</p></td>
<td><p>Alert for User API down</p></td>
<td><p>up{instance=”{CLUSTER_INSTANCE}”} &lt; 1</p></td>
<td><p>Verify status of the cluster.</p></td>
<td><p>Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-odd"><td><p>service requests missed producing results</p></td>
<td><p>Alert for mismatch between number of requests and documents produced</p></td>
<td><p>thoth_reporter_requests_gauge{env=”{CLUSTER_INSTANCE}”, component=”{THOTH_SERVICE}”} - thoth_reporter_reports_gauge{env=”{CLUSTER_INSTANCE}”, component=”{THOTH_SERVICE}”}</p></td>
<td><p>Verify status of Thoth investigator, Kafka, User_API.</p></td>
<td><p>Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-even"><td><p>purge job issues opened missed</p></td>
<td><p>Alert for mismatch between number of requests and documents produced</p></td>
<td><p>thoth_number_purge_issues_total{env=”zero-prod”} - thoth_number_purge_issues_created{env=”zero-prod”} &gt; 0</p></td>
<td><p>Retrigger Purge Job.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-odd"><td><p>thoth middletier number of worflows is 0</p></td>
<td><p>Alert for 0 workflows running in Thoth Middletier namespace</p></td>
<td><p>argo_workflows_count{field=”workflow-controller-metrics-thoth-middletier-prod.apps.smaug.na.operate-first.cloud:80”, status=”Running”} &lt; 1</p></td>
<td><p>Verify status of Data Ingestion in Thoth or add more workload.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-even"><td><p>mismatch between analyzed solvers and known solvers</p></td>
<td><p>Alert for number of solvers from Solver ConfigMap and from Thoth database not matching.</p></td>
<td><p>thoth_graphdb_solvers_number_match{field=”metrics-exporter-thoth-infra-prod.apps.smaug.na.operate-first.cloud:80”} == 1</p></td>
<td><p>Check solvers in Solver ConfigMap and in Thoth database.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-odd"><td><p>Issue connecting to Kafka</p></td>
<td><p>Alert for issue in connection with Kafka</p></td>
<td><p>thoth_kafka_connection_issues{field=”metrics-exporter-thoth-infra-prod.apps.smaug.na.operate-first.cloud:80”} == 1</p></td>
<td><p>Verify status of Kafka.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-even"><td><p>Kafka message is halted</p></td>
<td><p>Alert for halted messages</p></td>
<td><p>thoth_investigator_halted_topics{field=”investigator-faust-web-thoth-infra-prod.apps.smaug.na.operate-first.cloud:80”} == 1</p></td>
<td><p>Activate message again using endpoint in Thoth investigator.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-odd"><td><p>Issue connecting to Thoth database</p></td>
<td><p>Alert for issue in connection with Thoth database</p></td>
<td><p>thoth_graphdb_connection_issues{field=”metrics-exporter-thoth-infra-prod.apps.smaug.na.operate-first.cloud:80”} == 1</p></td>
<td><p>Verify status of Thoth database.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-even"><td><p>thoth-storages version mismatch</p></td>
<td><p>alembic version mismatch between components and database</p></td>
<td><p>thoth_graph_db_component_revision_check{env=”{CLUSTER_INSTANCE}”} == 1</p></td>
<td><p>Release all impacted components with thoth-storages in the correct version.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-odd"><td><p>Thoth database is corrupted</p></td>
<td><p>Database schema is corrupted, all services need to be stopped</p></td>
<td><p>thoth_graphdb_is_corrupted{field=”metrics-exporter-thoth-infra-prod.apps.smaug.na.operate-first.cloud:80”} == 1</p></td>
<td><p>Analyze Thoth database.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
<tr class="row-even"><td><p>Thoth database has multiple alembic versions</p></td>
<td><p>Alert for alembic version table corruption</p></td>
<td><p>thoth_graphdb_alembic_table_check{field=”metrics-exporter-thoth-infra-prod.apps.smaug.na.operate-first.cloud:80”} == 1</p></td>
<td><p>Analyze Thoth database.</p></td>
<td><p>Github Issue by Prometheus GitHub AlertManager</p></td>
</tr>
</tbody>
</table>
<p>The Kebechet rules triggered by Prometheus can be found <a class="reference external" href="https://github.com/thoth-station/thoth-application/blob/master/monitoring/overlays/moc-prod/alerting-rules.yaml">here</a>.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./examples/kebechet"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="accessing_metrics.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Accessing Metrics</p>
            </div>
        </a>
    </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Red Hat Artificial Intelligence Center of Excellence (AICoE)<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>